---
# ╔═══════════════════════════════════════════════════════════════════════╗
# ║  KUBERNETES SECRETS TEMPLATE FOR ERCP PROTOCOL                        ║
# ║                                                                       ║
# ║  ⚠️  WARNING: THIS IS A TEMPLATE FILE FOR DOCUMENTATION ONLY         ║
# ║  ⚠️  DO NOT USE THESE VALUES IN PRODUCTION                           ║
# ║  ⚠️  DO NOT COMMIT ACTUAL SECRETS TO VERSION CONTROL                 ║
# ╚═══════════════════════════════════════════════════════════════════════╝
#
# For Development/Testing Only:
# ────────────────────────────────────────────────────────────────────────
# 1. Copy this file: cp k8s/secrets.yaml k8s/secrets-development.yaml
# 2. Replace all REPLACE_ME_* placeholders with actual values
# 3. Apply to cluster: kubectl apply -f k8s/secrets-development.yaml
# 4. The file secrets-development.yaml is automatically gitignored
#
# For Production (RECOMMENDED):
# ────────────────────────────────────────────────────────────────────────
# Use External Secrets Management - DO NOT use files for secrets!
#
# Recommended Solutions:
# • AWS Secrets Manager + External Secrets Operator (ESO)
# • HashiCorp Vault + Vault Agent Injector
# • Google Secret Manager + Workload Identity
# • Azure Key Vault + CSI Driver
#
# See the External Secrets Operator example at the bottom of this file.
#
# Security Best Practices:
# ────────────────────────────────────────────────────────────────────────
# ✓ Use external secret management in production
# ✓ Rotate secrets regularly (every 90 days minimum)
# ✓ Use different secrets for each environment
# ✓ Enable secret encryption at rest in Kubernetes
# ✓ Audit secret access
# ✓ Use least-privilege access controls
# ✗ NEVER commit secrets to Git
# ✗ NEVER share secrets via Slack/Email
# ✗ NEVER log secrets

apiVersion: v1
kind: Secret
metadata:
  name: ercp-secrets
  namespace: default
  labels:
    app: ercp-protocol
    component: api-server
type: Opaque
stringData:
  # Database Configuration
  # PostgreSQL connection string
  # Format: postgresql+asyncpg://user:password@host:port/database
  # Generate password: openssl rand -base64 32
  DATABASE_URL: "postgresql+asyncpg://ercp_user:REPLACE_ME_DB_PASSWORD@postgres-service:5432/ercp_db"

  # Database Credentials (alternative format)
  DB_HOST: "postgres-service"
  DB_PORT: "5432"
  DB_NAME: "ercp_db"
  DB_USER: "ercp_user"
  DB_PASSWORD: "REPLACE_ME_DB_PASSWORD"

  # Redis Configuration
  REDIS_URL: "redis://redis-service:6379/0"
  # Generate password: openssl rand -base64 32
  REDIS_PASSWORD: "REPLACE_ME_REDIS_PASSWORD"

  # JWT Authentication
  # Generate with: openssl rand -hex 32
  # MUST be at least 32 characters for HS256
  JWT_SECRET_KEY: "REPLACE_ME_JWT_SECRET_KEY_MIN_32_CHARS"
  JWT_ALGORITHM: "HS256"
  JWT_EXPIRATION_HOURS: "24"

  # API Keys for External Services
  # OpenAI API (for LLM models)
  # Get from: https://platform.openai.com/api-keys
  OPENAI_API_KEY: "REPLACE_ME_OPENAI_API_KEY"

  # Hugging Face API (for NLI and embedding models)
  # Get from: https://huggingface.co/settings/tokens
  HUGGINGFACE_API_KEY: "REPLACE_ME_HUGGINGFACE_TOKEN"

  # Application Security
  # Secret key for Flask/FastAPI sessions
  # Generate with: python -c "import secrets; print(secrets.token_hex(32))"
  # MUST be at least 64 characters
  SECRET_KEY: "REPLACE_ME_APP_SECRET_KEY_MIN_64_CHARS"

  # CORS Configuration
  CORS_ORIGINS: "https://yourdomain.com,https://app.yourdomain.com"

  # Monitoring & Observability
  # Prometheus (if authentication required)
  PROMETHEUS_USERNAME: "prometheus"
  PROMETHEUS_PASSWORD: "REPLACE_ME_PROMETHEUS_PASSWORD"

  # Grafana (if using external Grafana)
  GRAFANA_ADMIN_PASSWORD: "REPLACE_ME_GRAFANA_PASSWORD"

  # OpenTelemetry (if using external collector)
  OTEL_EXPORTER_OTLP_ENDPOINT: "http://otel-collector:4317"
  OTEL_EXPORTER_OTLP_HEADERS: "api-key=REPLACE_ME_OTEL_API_KEY"

  # Sentry (Error Tracking)
  # Get from: https://sentry.io/settings/projects/
  SENTRY_DSN: "REPLACE_ME_SENTRY_DSN"

  # Email Configuration (for alerts)
  SMTP_HOST: "smtp.gmail.com"
  SMTP_PORT: "587"
  SMTP_USERNAME: "alerts@yourdomain.com"
  SMTP_PASSWORD: "REPLACE_ME_SMTP_APP_PASSWORD"
  SMTP_FROM: "ERCP Alerts <alerts@yourdomain.com>"

  # Cloud Storage (if using S3 for model artifacts)
  # Use IAM roles instead of static credentials when possible
  AWS_ACCESS_KEY_ID: "REPLACE_ME_AWS_ACCESS_KEY_ID"
  AWS_SECRET_ACCESS_KEY: "REPLACE_ME_AWS_SECRET_ACCESS_KEY"
  AWS_REGION: "us-east-1"
  S3_BUCKET_NAME: "ercp-model-artifacts"

---
# PostgreSQL Database Secret (if using external PostgreSQL)
apiVersion: v1
kind: Secret
metadata:
  name: postgres-credentials
  namespace: default
  labels:
    app: ercp-protocol
    component: database
type: Opaque
stringData:
  POSTGRES_DB: "ercp_db"
  POSTGRES_USER: "ercp_user"
  # Generate with: openssl rand -base64 32
  POSTGRES_PASSWORD: "REPLACE_ME_POSTGRES_PASSWORD"
  POSTGRES_HOST: "postgres-service"
  POSTGRES_PORT: "5432"

---
# Redis Secret (if using external Redis)
apiVersion: v1
kind: Secret
metadata:
  name: redis-credentials
  namespace: default
  labels:
    app: ercp-protocol
    component: cache
type: Opaque
stringData:
  # Generate with: openssl rand -base64 32
  REDIS_PASSWORD: "REPLACE_ME_REDIS_PASSWORD"

---
# TLS/SSL Certificates Secret (for HTTPS)
# Create from files:
# kubectl create secret tls ercp-tls-cert \
#   --cert=path/to/tls.crt \
#   --key=path/to/tls.key \
#   --namespace=default
apiVersion: v1
kind: Secret
metadata:
  name: ercp-tls-cert
  namespace: default
  labels:
    app: ercp-protocol
    component: ingress
type: kubernetes.io/tls
data:
  # Base64 encoded certificate and key
  # Replace with actual base64-encoded cert and key
  # Or create using kubectl create secret tls command above
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCi4uLgotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0t
  tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCi4uLgotLS0tLUVORCBQUklWQVRFIEtFWS0tLS0t

---
# Docker Registry Secret (if using private registry)
# Create with:
# kubectl create secret docker-registry ercp-registry-secret \
#   --docker-server=registry.example.com \
#   --docker-username=username \
#   --docker-password=password \
#   --docker-email=email@example.com
apiVersion: v1
kind: Secret
metadata:
  name: ercp-registry-secret
  namespace: default
type: kubernetes.io/dockerconfigjson
data:
  .dockerconfigjson: eyJhdXRocyI6eyJyZWdpc3RyeS5leGFtcGxlLmNvbSI6eyJ1c2VybmFtZSI6InVzZXJuYW1lIiwicGFzc3dvcmQiOiJwYXNzd29yZCIsImVtYWlsIjoiZW1haWxAZXhhbXBsZS5jb20iLCJhdXRoIjoiZFhObGNtNWhiV1U2Y0dGemMzZHZjbVE9In19fQ==

---
# ConfigMap for non-sensitive configuration
# (Not a secret, but often used alongside secrets)
apiVersion: v1
kind: ConfigMap
metadata:
  name: ercp-config
  namespace: default
  labels:
    app: ercp-protocol
data:
  # Application Configuration
  ENVIRONMENT: "production"
  LOG_LEVEL: "INFO"

  # Database Configuration
  DB_POOL_SIZE: "20"
  DB_MAX_OVERFLOW: "10"
  DB_ECHO: "false"

  # Redis Configuration
  REDIS_MAX_CONNECTIONS: "50"
  REDIS_SOCKET_TIMEOUT: "5"

  # API Configuration
  API_VERSION: "v2"
  MAX_REQUEST_SIZE_MB: "10"
  REQUEST_TIMEOUT_SECONDS: "300"

  # Rate Limiting
  RATE_LIMIT_ENABLED: "true"
  RATE_LIMIT_PER_MINUTE: "60"

  # ERCP Configuration
  ERCP_MAX_ITERATIONS: "10"
  ERCP_CONVERGENCE_THRESHOLD: "0.85"
  ERCP_TIMEOUT_SECONDS: "600"

  # Model Configuration
  DEFAULT_LLM_MODEL: "gpt-4"
  DEFAULT_NLI_MODEL: "microsoft/deberta-v3-large"
  DEFAULT_EMBEDDING_MODEL: "sentence-transformers/all-mpnet-base-v2"

  # Monitoring
  METRICS_ENABLED: "true"
  PROMETHEUS_PORT: "9090"
  HEALTH_CHECK_PATH: "/health"

---
# Example: Using External Secrets Operator (ESO)
# Requires External Secrets Operator installed in cluster
# https://external-secrets.io/
#
# apiVersion: external-secrets.io/v1beta1
# kind: SecretStore
# metadata:
#   name: aws-secrets-manager
#   namespace: default
# spec:
#   provider:
#     aws:
#       service: SecretsManager
#       region: us-east-1
#       auth:
#         jwt:
#           serviceAccountRef:
#             name: ercp-service-account
#
# ---
# apiVersion: external-secrets.io/v1beta1
# kind: ExternalSecret
# metadata:
#   name: ercp-external-secrets
#   namespace: default
# spec:
#   refreshInterval: 1h
#   secretStoreRef:
#     name: aws-secrets-manager
#     kind: SecretStore
#   target:
#     name: ercp-secrets
#     creationPolicy: Owner
#   data:
#     - secretKey: DATABASE_URL
#       remoteRef:
#         key: ercp/production/database-url
#     - secretKey: JWT_SECRET_KEY
#       remoteRef:
#         key: ercp/production/jwt-secret
#     - secretKey: OPENAI_API_KEY
#       remoteRef:
#         key: ercp/production/openai-api-key
